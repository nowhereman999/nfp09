;
; TTL '6809 FLOATING POINT PACKAGE - COPYRIGHT (C) MOTOROLA 1980'
;
;*****************************************************************
;
;    G L O B A L  E Q U A T E S
;
;	 THESE ARE THE GLOBAL EQUATES FOR THE 6809 FP PACKAGE
;
;*****************************************************************

	include "../abi/nfp09-abi.s"

;
; VERSION OF THIS SOFTWARE PACKAGE
;
NFP09_MAJOR_VERSION	EQU	'0'
NFP09_MINOR_VERSION	EQU	'1'

;
; BIT VALUES
;
BIT0	EQU	_bit0_
BIT1	EQU	_bit1_
BIT2	EQU	_bit2_
BIT3	EQU	_bit3_
BIT4	EQU	_bit4_
BIT5	EQU	_bit5_
BIT6	EQU	_bit6_
BIT7	EQU	_bit7_
BIT8	EQU	_bit8_
BIT9	EQU	_bit9_
BIT10	EQU	_bit10_
BIT11	EQU	_bit11_
BIT12	EQU	_bit12_
BIT13	EQU	_bit13_
BIT14	EQU	_bit14_
BIT15	EQU	_bit15_

;
; CONDITION CODE BITS
;   USED IN ORCC TO SET A CC BIT
;
N	EQU	BIT3
Z	EQU	BIT2
V	EQU	BIT1
C	EQU	BIT0

;
; CONDITION CODE BIT MASKS
;    USED IN ANDCC TO CLEAR SINGLE BITS
;
NN	EQU	$F7
NZ	EQU	$FB
NV	EQU	$FD
NC	EQU	$FE

;
;
;
;      STACK FRAME EQUATES
;
;
;				  INITIALIZED BY:
FUNCT	EQU	0		; IREG/ISTACK
PTOS	EQU	FUNCT+1		; IREG/ISTACK
PFPCB	EQU	PTOS+2		; IREG/ISTACK
RPREC	EQU	PFPCB+2		; IREG/ISTACK
TSTAT	EQU	RPREC+1		; IREG/ISTACK = 0
TPARAM	EQU	TSTAT+2		; IREG/ISTACK
STIKY	EQU	TPARAM+2	; ****************************************
RESULT	EQU	STIKY+1		; * EVERYTHING FROM STICKY TO TYPE1 IS ***
SIGNR	EQU	RESULT		; * ZEROED BY ISTACK/IREG              ***
EXPR	EQU	RESULT+1
FRACTR	EQU	EXPR+2
TYPER	EQU	FRACTR+9
ARG2	EQU	TYPER+1		;   SET BY GETARG
SIGN2	EQU	ARG2
EXP2	EQU	ARG2+1
FRACT2	EQU	EXP2+2
TYPE2	EQU	FRACT2+9
ARG1	EQU	TYPE2+1		;   SET BY GETARG IF DYADIC
SIGN1	EQU	ARG1
EXP1	EQU	ARG1+1
FRACT1	EQU	EXP1+2
TYPE1	EQU	FRACT1+9	;   IXIT (0); CHANGED BY GETARG IF DYADIC
;				  ****************************************
ARGSIZ	EQU	TYPE2-ARG2+1
;
; STACK CALLS
ISTKPC	EQU	TYPE1+1		; USER'S REGISTERS, SAVED BY PSHS
CCREG	EQU	ISTKPC+2
DREG	EQU	CCREG+1
XREG	EQU	DREG+2
YREG	EQU	XREG+2
UREG	EQU	YREG+2
CALLPC	EQU	UREG+2
;
; REGISTER CALLS
IREGPC	EQU	TYPE1+1		; USER'S REGISTERS; SAVED BY PSHS
PFPCB2	EQU	IREGPC+3
PRESUL	EQU	PFPCB2+2
PARG2	EQU	PRESUL+2
PARG1	EQU	PARG2+2
;
; TOTAL SIZE OF STACK FRAME
STKSIZ	EQU	CALLPC+2-FUNCT
;
; SIZE OF STACK FRAME FROM IREG OR ISTACK TO BOTTOM
;
FRMSIZ	EQU	ISTKPC-FUNCT
;
;
; SIZE OF CALLERS REGS (EXCEPT PC)
;
SIZREG	EQU	CALLPC-CCREG
;
; OFFSETS FOR INDIVIDUAL ARGUMENTS ON STACK FRAME
;
SIGN	EQU	0
EXP	EQU	SIGN+1
FRACT	EQU	EXP+2
TYPE	EQU	FRACT+9
;
; ALIASES FOR SOME STACK FRAME ENTRIES
;
P	EQU	TPARAM+1	; EQUATE USED IN DECBIN
K	EQU	TPARAM+1	; EQUATE USED IN BINDEC

;
;  ARGUMENT TYPES
;
TYNORM	EQU	0
TYZERO	EQU	2
TYINF	EQU	4
TYNAN	EQU	6
TYNNRM	EQU	8

;
; EXPONENT BIASES
;
SBIAS	EQU	127		; SINGLE PRECISION BIAS
DBIAS	EQU	1023		; DOUBLE PRECISION BIAS

;
; MISCELLANEOUS EQUATES
;
BIGIOP	EQU	17		; MAXIMUM LEGAL IOP NUMBER
POFF	EQU	25		; OFFSET TO P IN BCD STRING

;
; FPCB REGISTER EQUATES
;
CTL	EQU	FPCB_FP_CTRL	; CONTROL REG
ENB	EQU	FPCB_FP_TRAPEN	; ENABLE BYTE
ERR	EQU	FPCB_FP_STAT	; ERROR STATUS BYTE
SS	EQU	FPCB_FP_SSTAT	; SECONDARY STATUS
TRAPV	EQU	FPCB_FP_TRAPVEC	; TRAP VECTOR

;
; CONTROL BYTE
;
CTLAFF	EQU	FP_CTRL_CLOS	; AFFINE/PROJECTIVE FLAG
CTLRND	EQU	FP_CTRL_RND	; ROUNDING MODE
CTLNRM	EQU	FP_CTRL_NRM	; NORMALIZE FLAG
CTLSIZ	EQU	FP_CTRL_PREC

;
; ERROR STATUS BYTE
;
ERRIOP	EQU	FP_ERR_IOP	; IOP ERROR
ERROVF	EQU	FP_ERR_OVF	; OVERFLOW ERROR
ERRUNF	EQU	FP_ERR_UNF	; UNDERFLOW ERROR
ERRDZ	EQU	FP_ERR_DZ	; DIVIDE BY ZERO ERROR
ERRUN	EQU	FP_ERR_UN	; UNORDERED COMPARE ERROR
ERRIOV	EQU	FP_ERR_IOV	; INTEGER OVERFLOW ERROR
ERRINX	EQU	FP_ERR_INX	; INEXACT ERROR

;
; TRAP ENABLE BYTE
;
ENBIOP	EQU	FP_ERR_IOP	; INVALID OPERATION
ENBOVF	EQU	FP_ERR_OVF	; OVERFLOW
ENBUNF	EQU	FP_ERR_UNF	; UNDERFLOW
ENBDZ	EQU	FP_ERR_DZ	; DIVIDE BY ZERO
ENBUN	EQU	FP_ERR_UN	; UNORDERED
ENBIOV	EQU	FP_ERR_IOV	; INTEGER OVERFLOW
ENBINX	EQU	FP_ERR_INX	; INEXACT

;
; PRECISION MODES IN CONTROL BYTE
;
PRSIN	EQU	FP_CTRL_SINGLE	; SINGLE
PRDBL	EQU	FP_CTRL_DOUBLE	; DOUBLE
PREXT	EQU	FP_CTRL_EXT	; EXTENDED
PREFS	EQU	FP_CTRL_EXTFS	; EXTENDED FORCED TO SINGLE
PREFD	EQU	FP_CTRL_EXTFD	; EXTENDED FORCED TO DOUBLE

;
; ROUNDING MODES IN CONTROL BYTE
;
RN	EQU	FP_CTRL_RN	; ROUND TO NEAREST
RZ	EQU	FP_CTRL_RZ	; ROUND TO ZERO
RP	EQU	FP_CTRL_RP	; ROUND TO PLUS INFINITY
RM	EQU	FP_CTRL_RM	; ROUND TO MINUS INFINITY

;
; CLOSURE MODES IN CONTROL BYTE
;
PROJEC	EQU	FP_CTRL_PROJ	; PROJECTIVE CLOSURE
AFFINE	EQU	FP_CTRL_AFF	; AFFINE CLOSURE

;
; PRECISION INDEXES IN RPREC
;
SIN	EQU	0
DBL	EQU	2
EXT	EQU	4
EFS	EQU	6
EFD	EQU	8
CLRFRC	EQU	10		; (USED BY 'CLRES' FOR ENTIRE FRACTION)
CLRALL	EQU	12		; (USED BY 'CLRES' FOR ENTIRE ARGUMENT)

;
; SECONDARY STATUS  BYTE
;
SSIOP	EQU	BIT0+BIT1+BIT2+BIT3+BIT4

;
;
;     FUNCTION CODE EQUATES
;
;     BIT 7 = 1 = MIXED SIZE ARGUMENTS (MOV,CMP)
;     BIT 6 = 1 = TRAP ON UNORDERED COMPARE
;     BIT5-BIT0 = FUNCTION NUMBER
;
;
MIXED	EQU	FPOP_M
TONUN	EQU	FPOP_T		; TRAP ON UNORDERED

FCADD	EQU	FPOP_FADD
FCSUB	EQU	FPOP_FSUB
FCMUL	EQU	FPOP_FMUL
FCDIV	EQU	FPOP_FDIV
FCREM	EQU	FPOP_FREM
FCCMP	EQU	FPOP_FCMP
FCTCMP	EQU	FPOP_FTCMP
FCPCMP	EQU	FPOP_FPCMP
FCTPCM	EQU	FPOP_FTPCMP
FCSQRT	EQU	FPOP_FSQRT
FCINT	EQU	FPOP_FINT
FCFIXS	EQU	FPOP_FFIXS
FCFIXD	EQU	FPOP_FFIXD
FCMOV	EQU	FPOP_FMOV
FCBNDC	EQU	FPOP_BINDEC
FCAB	EQU	FPOP_FABS
FCNEG	EQU	FPOP_FNEG

;
;    THE FOLLOWING OPCODES DO NOT GO THROUGH
;  A JUMP-ADDRESS TABLE.
;	NOTE: THE 'FCAB' AND 'FCNEG' WILL
;  NOT EVEN GO THROUGH THE DISPATCH ROUTINE.
;
FCNOJP	EQU	FPOP_DECBIN	; MARKS OPCODES WITHOUT TABLES

FCDCBN	EQU	FPOP_DECBIN
FCFLTS	EQU	FPOP_FFLTS
FCFLTD	EQU	FPOP_FFLTD

;
; MAX ALLOWABLE OPCODE
;
FCMAX	EQU	FCFLTD

;
; EXPONENT EQUATES
;
; MAXIMUM EXPONENTS
;
SMAXEX	EQU	$0080		; SINGLE
DMAXEX	EQU	$0400		; DOUBLE
EMAXEX	EQU	$3FFF		; EXTENDED

;
; MINIMUM EXPONENTS
;
SMINEX	EQU	$FF81		; SINGLE
DMINEX	EQU	$FC01		; DOUBLE
EMINEX	EQU	$C000		; EXTENDED

INFEX	EQU	$7FFF		; INFINITE EXPONENT
ZEROEX	EQU	$8000		; ZERO EXPONENT INTERNAL FORMAT

;
; INS AND OUTS BCD ARRAY EQUATES
;
SE	EQU	0		; SIGN EXPONENT
SF	EQU	5		; SIGN FRACTION
EXPDIG	EQU	4		; NO. OF BCD DIGITS IN EXPONENT
SIGDIG	EQU	19		; NO. OF BCD DIGITS IN FRACTION
DECEXP	EQU	1		; START OF BCD EXPONENT
DECSIG	EQU	6		; START OF BCD FRACTION

MAXP	EQU	19		; MAXIMUM VALUE FOR P ON DECBIN( INS )
MAXK	EQU	17		; MAXIMUM VALUE FOR K ON BINDEC( OUTS )

;
; SIZES OF STACK FRAME ENTITIES
;
FRACSZ	EQU	72		; NO. OF BITS IN FRACTION
EXPSIZ	EQU	16		; NO. OF BITS IN EXPONENT

;
; BOOLEAN EQUATES
;
TRUE	EQU	00
FALSE	EQU	$FF
